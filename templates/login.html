{% extends "layout.html" %}
{% block content %}
<style>
.auth-container { min-height: 70vh; display: flex; align-items: center; justify-content: center; position: relative; padding: 1rem; }
.auth-card { background: linear-gradient(145deg, #f0f2f5, #e6e9ef); box-shadow: -20px -20px 60px #ffffff, 20px 20px 60px #c8cdd6; border-radius: 30px; padding: 1.5rem; max-width: 420px; width: 100%; position: relative; overflow: hidden; }
@media (max-width: 640px) {
  .auth-card { padding: 1rem; border-radius: 20px; box-shadow: -10px -10px 30px #ffffff, 10px 10px 30px #c8cdd6; }
  .auth-container { min-height: 60vh; }
}
.auth-card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(99, 102, 241, 0.1), transparent); transform: rotate(45deg); animation: shimmer 3s infinite; }
@keyframes shimmer { 0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); } 50% { transform: translateX(100%) translateY(100%) rotate(45deg); } }
.form-input { background: #EBECF0; border: none; border-radius: 25px; padding: 12px 20px; width: 100%; box-shadow: inset 8px 8px 16px #c8cdd6, inset -8px -8px 16px #ffffff; transition: all 0.3s ease; font-size: 16px; }
@media (max-width: 640px) {
  .form-input { padding: 10px 16px; font-size: 14px; border-radius: 20px; }
}
.form-input:focus { box-shadow: inset 4px 4px 8px #c8cdd6, inset -4px -4px 8px #ffffff; outline: none; transform: scale(1.02); }
.form-input::placeholder { color: #a0a6b8; }
.submit-btn { background: linear-gradient(145deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; padding: 14px; width: 100%; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: -8px -8px 20px #ffffff, 8px 8px 20px #c8cdd6; position: relative; overflow: hidden; }
@media (max-width: 640px) {
  .submit-btn { padding: 12px; font-size: 16px; border-radius: 20px; }
}
.submit-btn:hover { transform: translateY(-2px); box-shadow: -12px -12px 30px #ffffff, 12px 12px 30px #c8cdd6; }
.submit-btn:active { transform: translateY(0); }
.submit-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s; }
.submit-btn:hover::before { left: 100%; }
.input-group { position: relative; margin-bottom: 18px; }
.input-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 20px; z-index: 1; }
.form-input.with-icon { padding-left: 60px; }
@media (max-width: 640px) {
  .input-icon { left: 16px; font-size: 18px; }
  .form-input.with-icon { padding-left: 50px; }
}
.fade-in { animation: fadeInUp 0.8s ease-out; }
.slide-in { animation: slideIn 0.6s ease-out; }
@keyframes slideIn { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.error-message { background: #fee; color: #c53030; padding: 12px 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #e53e3e; animation: shake 0.5s ease-in-out; }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
.side-icon { position: absolute; font-size: 3rem; color: #4338ca; opacity: 0.6; animation: float 4s ease-in-out infinite; }
.side-icon.left { left: 10%; top: 20%; animation-delay: 0s; }
.side-icon.right { right: 10%; top: 60%; animation-delay: 2s; }
.bg-icon { position: absolute; font-size: 2rem; color: #4338ca; opacity: 0.4; animation: drift 8s ease-in-out infinite; }
.bg-icon:nth-child(1) { left: 5%; top: 10%; animation-delay: 0s; color: #4338ca; }
.bg-icon:nth-child(2) { right: 8%; top: 15%; animation-delay: 1s; color: #6366f1; }
.bg-icon:nth-child(3) { left: 15%; bottom: 20%; animation-delay: 2s; color: #8b5cf6; }
.bg-icon:nth-child(4) { right: 12%; bottom: 25%; animation-delay: 3s; color: #a855f7; }
.bg-icon:nth-child(5) { left: 3%; top: 50%; animation-delay: 4s; color: #4338ca; }
.bg-icon:nth-child(6) { right: 5%; top: 40%; animation-delay: 5s; color: #6366f1; }
@keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
@keyframes drift { 0%, 100% { transform: translateX(0px) translateY(0px) rotate(0deg); } 25% { transform: translateX(10px) translateY(-15px) rotate(2deg); } 75% { transform: translateX(-10px) translateY(10px) rotate(-2deg); } }
</style>

<div class="auth-container">
  <div class="bg-icon">ü©∫</div>
  <div class="bg-icon">üíä</div>
  <div class="bg-icon">üìä</div>
  <div class="bg-icon">‚ù§Ô∏è</div>
  <div class="bg-icon">üå±</div>
  <div class="bg-icon">üî¨</div>
  <div class="side-icon left">ü©∫</div>
  <div class="side-icon right">üíä</div>
  <div class="auth-card fade-in">
    <div class="text-center mb-4 sm:mb-6">
      <div class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-2 sm:mb-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl sm:text-2xl shadow-lg">
        üîê
      </div>
      <h1 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1">Welcome Back</h1>
      <p class="text-gray-600 text-xs sm:text-sm">Sign in to continue</p>
    </div>
    
    <div id="error-container"></div>
    
    <form id="login-form" class="space-y-3 sm:space-y-4">
      <div class="input-group slide-in" style="animation-delay: 0.2s">
        <div class="input-icon">üë§</div>
        <input name="username" type="text" class="form-input with-icon" placeholder="Enter your username" required>
      </div>
      
      <div class="input-group slide-in" style="animation-delay: 0.4s">
        <div class="input-icon">üîí</div>
        <input name="password" type="password" class="form-input with-icon" placeholder="Enter your password" required>
      </div>
      
      <button type="submit" class="submit-btn slide-in" style="animation-delay: 0.6s">
        <span class="btn-text">üöÄ Sign In</span>
      </button>
    </form>
    
    <div class="text-center mt-4 sm:mt-5 slide-in" style="animation-delay: 0.8s">
      <p class="text-gray-600 text-xs sm:text-sm">Don't have an account?</p>
      <a href="/register" class="text-indigo-600 hover:text-indigo-800 font-semibold transition-colors duration-300 hover:underline text-sm sm:text-base">
        Create one now ‚Üí
      </a>
    </div>
  </div>
</div>

<script>
function showError(message) {
  const container = document.getElementById('error-container');
  container.innerHTML = `<div class="error-message">${message}</div>`;
  setTimeout(() => container.innerHTML = '', 5000);
}

document.getElementById("login-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const btnText = submitBtn.querySelector('.btn-text');
  const originalText = btnText.innerHTML;
  
  // Animate button
  btnText.innerHTML = '‚è≥ Signing in...';
  submitBtn.disabled = true;
  submitBtn.style.transform = 'scale(0.98)';
  
  try {
    const data = Object.fromEntries(new FormData(e.target).entries());
    const res = await fetch("/api/login", {
      method: "POST",
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const out = await res.json();
    
    if (out.error) { 
      showError('‚ùå ' + out.error);
      return; 
    }
    
    location.href = "/";
    
  } catch (error) {
    showError('‚ö†Ô∏è Connection error. Please try again.');
  } finally {
    btnText.innerHTML = originalText;
    submitBtn.disabled = false;
    submitBtn.style.transform = 'scale(1)';
  }
});

// Add input focus animations
document.querySelectorAll('.form-input').forEach(input => {
  input.addEventListener('focus', () => {
    input.parentElement.style.transform = 'translateY(-2px)';
  });
  
  input.addEventListener('blur', () => {
    input.parentElement.style.transform = 'translateY(0)';
  });
});
</script>
{% endblock %}