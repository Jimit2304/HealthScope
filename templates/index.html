{% extends "layout.html" %}
{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Initial Form View -->
    <div id="form-view">
      <!-- Header Section -->
      <div class="text-center mb-12">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mb-6">
          <span class="text-3xl text-white">ü©∫</span>
        </div>
        <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
          HealthScope AI
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
          Advanced diabetes risk assessment powered by machine learning
        </p>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
        <!-- Form Section -->
        <div class="xl:col-span-3">
          <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-6">
              <h2 class="text-2xl font-bold text-white mb-2">Health Assessment Form</h2>
              <p class="text-blue-100">Please provide accurate information for the best results</p>
            </div>
            <form id="predict-form" class="p-8 space-y-6">
            
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Pregnancies -->
                <div class="group">
                  <label class="flex items-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-pink-600">ü§±</span>
                    </div>
                    Pregnancies
                    <span class="text-xs text-gray-500 ml-2">(0-10)</span>
                  </label>
                  <input name="pregnancies" type="number" min="0" max="10" placeholder="Enter number" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                </div>
              
                <!-- Glucose -->
                <div class="group">
                  <label class="flex items-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-red-600">ü©∏</span>
                    </div>
                    Glucose Level
                    <span class="text-xs text-gray-500 ml-2">(mg/dL)</span>
                  </label>
                  <input name="glucose" type="number" min="70" max="300" placeholder="Enter glucose level" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                  <div class="text-xs text-gray-500 mt-2 px-2">
                    <span class="inline-block bg-green-100 text-green-700 px-2 py-1 rounded mr-2">Normal: 70-99</span>
                    <span class="inline-block bg-yellow-100 text-yellow-700 px-2 py-1 rounded mr-2">Pre: 100-125</span>
                    <span class="inline-block bg-red-100 text-red-700 px-2 py-1 rounded">High: 126+</span>
                  </div>
                </div>
              
                <!-- Blood Pressure -->
                <div class="group">
                  <label class="flex items-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-purple-600">üíì</span>
                    </div>
                    Blood Pressure
                    <span class="text-xs text-gray-500 ml-2">(mmHg)</span>
                  </label>
                  <input name="blood_pressure" type="number" min="60" max="200" placeholder="Enter BP" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                  <div class="text-xs text-gray-500 mt-2 px-2">
                    <span class="inline-block bg-green-100 text-green-700 px-2 py-1 rounded mr-2">Normal: <120</span>
                    <span class="inline-block bg-red-100 text-red-700 px-2 py-1 rounded">High: 130+</span>
                  </div>
                </div>
              
                <!-- Insulin -->
                <div class="group">
                  <label class="flex items-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-blue-600">üíâ</span>
                    </div>
                    Insulin Level
                    <span class="text-xs text-gray-500 ml-2">(ŒºU/mL)</span>
                  </label>
                  <input name="insulin" type="number" min="0" max="200" placeholder="Enter insulin level" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                </div>
              
                <!-- BMI -->
                <div class="group">
                  <label class="flex items-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-green-600">‚öñÔ∏è</span>
                    </div>
                    Body Mass Index
                    <span class="text-xs text-gray-500 ml-2">(BMI)</span>
                  </label>
                  <input name="bmi" type="number" step="0.1" min="15" max="50" placeholder="Enter BMI" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                  <div class="text-xs text-gray-500 mt-2 px-2">
                    <span class="inline-block bg-blue-100 text-blue-700 px-2 py-1 rounded mr-2">Normal: 18.5-24.9</span>
                    <span class="inline-block bg-yellow-100 text-yellow-700 px-2 py-1 rounded mr-2">Over: 25-29.9</span>
                    <span class="inline-block bg-red-100 text-red-700 px-2 py-1 rounded">Obese: 30+</span>
                  </div>
                </div>
              
                <!-- Age -->
                <div class="group">
                  <label class="flex items-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-orange-600">üéÇ</span>
                    </div>
                    Age
                    <span class="text-xs text-gray-500 ml-2">(years)</span>
                  </label>
                  <input name="age" type="number" min="18" max="100" placeholder="Enter age" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                </div>
              </div>
            
              <!-- Family Diabetes History -->
              <div class="md:col-span-2">
                <div class="max-w-md mx-auto">
                  <label class="flex items-center justify-center text-sm font-semibold text-gray-700 mb-3">
                    <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                      <span class="text-indigo-600">üë®üë©üëßüë¶</span>
                    </div>
                    Family Members with Diabetes
                    <span class="text-xs text-gray-500 ml-2">(count)</span>
                  </label>
                  <input name="family_diabetes" type="number" min="0" max="10" placeholder="Enter count" required 
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 text-gray-700 placeholder-gray-400">
                  <div class="text-xs text-gray-500 mt-2 text-center px-2">
                    Number of immediate family members with diabetes
                  </div>
                </div>
              </div>
            
              <!-- Submit Button -->
              <div class="pt-4">
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl">
                  <span class="flex items-center justify-center space-x-3">
                    <span class="text-xl">üîç</span>
                    <span class="text-lg">Analyze My Health Risk</span>
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      
        <!-- Health Guidelines Panel -->
        <div class="xl:col-span-1">
          <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 sticky top-8">
            <div class="text-center mb-6">
              <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
                <span class="text-2xl text-white">üìä</span>
              </div>
              <h3 class="text-xl font-bold text-gray-800">Health Guidelines</h3>
              <p class="text-sm text-gray-500 mt-1">Reference ranges</p>
            </div>
          
            <div class="space-y-4">
              <!-- Glucose Levels -->
              <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-xl p-4 border border-red-100">
                <div class="flex items-center mb-3">
                  <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                    <span class="text-red-600">ü©∏</span>
                  </div>
                  <h4 class="font-bold text-red-800">Glucose Levels</h4>
                </div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between items-center">
                    <span class="text-green-700">Normal</span>
                    <span class="font-medium text-green-800">70-99 mg/dL</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-yellow-700">Prediabetic</span>
                    <span class="font-medium text-yellow-800">100-125 mg/dL</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-red-700">Diabetic</span>
                    <span class="font-medium text-red-800">126+ mg/dL</span>
                  </div>
                </div>
              </div>
              
              <!-- BMI Categories -->
              <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100">
                <div class="flex items-center mb-3">
                  <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                    <span class="text-green-600">‚öñÔ∏è</span>
                  </div>
                  <h4 class="font-bold text-green-800">BMI Categories</h4>
                </div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between items-center">
                    <span class="text-blue-700">Underweight</span>
                    <span class="font-medium text-blue-800"><18.5</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-green-700">Normal</span>
                    <span class="font-medium text-green-800">18.5-24.9</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-yellow-700">Overweight</span>
                    <span class="font-medium text-yellow-800">25-29.9</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-red-700">Obese</span>
                    <span class="font-medium text-red-800">30+</span>
                  </div>
                </div>
              </div>
              
              <!-- Blood Pressure -->
              <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-4 border border-purple-100">
                <div class="flex items-center mb-3">
                  <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                    <span class="text-purple-600">üíì</span>
                  </div>
                  <h4 class="font-bold text-purple-800">Blood Pressure</h4>
                </div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between items-center">
                    <span class="text-green-700">Normal</span>
                    <span class="font-medium text-green-800"><120 mmHg</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-yellow-700">Elevated</span>
                    <span class="font-medium text-yellow-800">120-129 mmHg</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-red-700">High</span>
                    <span class="font-medium text-red-800">130+ mmHg</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading View -->
  <div id="loading-view" class="hidden">
    <div class="max-w-4xl mx-auto">
      <div class="neumorphic-card p-12 text-center relative overflow-hidden">
        <!-- Background Animation -->
        <div class="absolute inset-0 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 opacity-50"></div>
        <div class="absolute top-0 left-0 w-full h-full">
          <div class="absolute top-10 left-10 w-20 h-20 bg-blue-200 rounded-full opacity-30 animate-pulse"></div>
          <div class="absolute top-20 right-20 w-16 h-16 bg-purple-200 rounded-full opacity-40 animate-bounce"></div>
          <div class="absolute bottom-20 left-20 w-12 h-12 bg-pink-200 rounded-full opacity-35 animate-ping"></div>
        </div>
        
        <!-- Main Content -->
        <div class="relative z-10">
          <!-- DNA Helix Animation -->
          <div class="mb-8 flex justify-center">
            <div class="relative w-24 h-24">
              <div class="absolute inset-0 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
              <div class="absolute inset-2 border-4 border-purple-500 border-b-transparent rounded-full animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
              <div class="absolute inset-4 border-4 border-pink-500 border-l-transparent rounded-full animate-spin" style="animation-duration: 2s;"></div>
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="w-4 h-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full animate-pulse"></div>
              </div>
            </div>
          </div>
          
          <!-- Title with Gradient -->
          <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">
            üß¨ HealthScope AI Analysis
          </h2>
          
          <!-- Subtitle -->
          <p class="text-gray-600 mb-8 text-lg">Advanced machine learning algorithms at work</p>
          
          <!-- Progress Circle -->
          <div class="relative w-32 h-32 mx-auto mb-8">
            <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
              <circle id="loading-progress-circle" cx="50" cy="50" r="40" stroke="url(#gradient)" stroke-width="8" fill="none" 
                      stroke-linecap="round" stroke-dasharray="251.2" stroke-dashoffset="251.2" class="transition-all duration-500">
                <defs>
                  <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                    <stop offset="50%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                  </linearGradient>
                </defs>
              </circle>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <span id="loading-percentage" class="text-2xl font-bold text-gray-800">0%</span>
            </div>
          </div>
          
          <!-- Loading Steps -->
          <div class="space-y-4 mb-8">
            <div id="step-1" class="flex items-center justify-center space-x-3 opacity-30 transition-all duration-500">
              <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
              <span class="text-sm font-medium">Processing Health Metrics</span>
            </div>
            <div id="step-2" class="flex items-center justify-center space-x-3 opacity-30 transition-all duration-500">
              <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
              <span class="text-sm font-medium">Running ML Algorithms</span>
            </div>
            <div id="step-3" class="flex items-center justify-center space-x-3 opacity-30 transition-all duration-500">
              <div class="w-3 h-3 bg-pink-500 rounded-full"></div>
              <span class="text-sm font-medium">Analyzing Risk Factors</span>
            </div>
            <div id="step-4" class="flex items-center justify-center space-x-3 opacity-30 transition-all duration-500">
              <div class="w-3 h-3 bg-green-500 rounded-full"></div>
              <span class="text-sm font-medium">Generating Results</span>
            </div>
          </div>
          
          <!-- Status Text -->
          <p id="loading-status" class="text-sm text-gray-500 animate-pulse">Initializing AI models...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Results View -->
  <div id="results-view" class="hidden">
    <div class="max-w-4xl mx-auto">
      <div class="neumorphic-card p-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Left Side: Risk Level & Circle -->
          <div class="text-center">
            <h2 class="text-lg font-medium text-gray-600 mb-4">Predicted Risk Level</h2>
            <h1 id="risk-title" class="text-4xl font-bold text-orange-500 mb-6">Moderate Risk</h1>
            
            <!-- Circular Progress -->
            <div class="relative w-48 h-48 mx-auto mb-6">
              <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                <circle id="progress-circle" cx="50" cy="50" r="40" stroke="#f59e0b" stroke-width="8" fill="none" 
                        stroke-linecap="round" stroke-dasharray="251.2" stroke-dashoffset="125.6"/>
              </svg>
              <div class="absolute inset-0 flex items-center justify-center">
                <span id="risk-percentage" class="text-4xl font-bold text-gray-800">54%</span>
              </div>
            </div>
            
            <!-- Prediction Result -->
            <div class="text-center mb-6">
              <h3 class="text-lg font-semibold text-gray-700 mb-2">Prediction Result</h3>
              <div id="prediction-result" class="text-2xl font-bold text-red-600">Diabetic</div>
            </div>
            
            <!-- Key Factors -->
            <div class="text-left">
              <h3 class="text-lg font-semibold text-gray-700 mb-3">Key Factors</h3>
              <p id="key-factors-text" class="text-gray-600 text-sm">Your Glucose and BMI levels were primary factors in this prediction.</p>
            </div>
          </div>
          
          <!-- Right Side: BMI, Glucose & Advice -->
          <div class="space-y-6">
            <!-- BMI Bar -->
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-700 font-medium">Your BMI</span>
                <span id="bmi-value" class="font-bold text-red-600">33.6 Obese</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3 relative">
                <div class="h-3 rounded-full bg-gradient-to-r from-blue-400 via-green-400 via-yellow-400 to-red-500"></div>
                <div id="bmi-indicator" class="absolute w-1 h-5 bg-black top-0 rounded" style="left: 80%;"></div>
              </div>
            </div>
            
            <!-- Glucose Bar -->
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-700 font-medium">Your Glucose</span>
                <span id="glucose-value" class="font-bold text-red-600">148 mg/dL Diabetes</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3 relative">
                <div class="h-3 rounded-full bg-gradient-to-r from-green-400 via-yellow-400 to-red-500"></div>
                <div id="glucose-indicator" class="absolute w-1 h-5 bg-black top-0 rounded" style="left: 70%;"></div>
              </div>
            </div>
            
            <!-- Personalized Advice -->
            <div class="mt-8">
              <h3 class="text-lg font-semibold text-gray-700 mb-4">Personalized Advice</h3>
              <div id="advice-list" class="space-y-3">
                <div class="flex items-start space-x-3">
                  <span class="text-xl">üçé</span>
                  <p class="text-gray-600 text-sm">Incorporate more fruits, vegetables, and whole grains.</p>
                </div>
                <div class="flex items-start space-x-2 sm:space-x-3">
                  <span class="text-lg sm:text-xl">üíß</span>
                  <p class="text-gray-600 text-xs sm:text-sm">Ensure you are staying well-hydrated.</p>
                </div>
                <div class="flex items-start space-x-2 sm:space-x-3">
                  <span class="text-lg sm:text-xl">üóìÔ∏è</span>
                  <p class="text-gray-600 text-xs sm:text-sm">Consider regular monitoring and a check-up.</p>
                </div>
              </div>
            </div>
            
            <!-- Health Tips -->
            <div class="mt-8">
              <h3 class="text-lg font-semibold text-gray-700 mb-4">Health Tips</h3>
              <div class="space-y-3">
                <div class="flex items-start space-x-2 sm:space-x-3">
                  <span class="text-lg sm:text-xl">üèÉ‚ôÇÔ∏è</span>
                  <p class="text-gray-600 text-xs sm:text-sm">Regular exercise improves insulin sensitivity</p>
                </div>
                <div class="flex items-start space-x-2 sm:space-x-3">
                  <span class="text-lg sm:text-xl">ü•ó</span>
                  <p class="text-gray-600 text-xs sm:text-sm">Balanced diet helps manage blood sugar</p>
                </div>
                <div class="flex items-start space-x-2 sm:space-x-3">
                  <span class="text-lg sm:text-xl">üíß</span>
                  <p class="text-gray-600 text-xs sm:text-sm">Stay hydrated for better health</p>
                </div>
                <div class="flex items-start space-x-2 sm:space-x-3">
                  <span class="text-lg sm:text-xl">üò¥</span>
                  <p class="text-gray-600 text-xs sm:text-sm">Quality sleep regulates hormones</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Try Again Button -->
        <div class="text-center mt-8">
          <button id="try-again-btn" class="px-8 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors">
            Try Again
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Auth Required Modal -->
<div id="auth-modal" class="fixed inset-0 hidden flex items-center justify-center z-50 p-4">
  <div class="neumorphic-card max-w-md w-full bg-white relative overflow-hidden">
    <!-- Background Animation -->
    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full opacity-50 -translate-y-16 translate-x-16"></div>
    <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-pink-100 to-yellow-100 rounded-full opacity-40 translate-y-12 -translate-x-12"></div>
    
    <div class="relative z-10 p-8 text-center">
      <!-- Icon -->
      <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
        </svg>
      </div>
      
      <!-- Title -->
      <h3 class="text-2xl font-bold text-gray-800 mb-4">Authentication Required</h3>
      
      <!-- Message -->
      <p class="text-gray-600 mb-8 leading-relaxed">
        Please log in to access the diabetes risk prediction feature and save your health analysis results.
      </p>
      
      <!-- Buttons -->
      <div class="flex flex-col sm:flex-row gap-3">
        <a href="/login" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-200 flex items-center justify-center space-x-2">
          <span>üîê</span>
          <span>Login</span>
        </a>
        <a href="/register" class="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-200 transition-colors flex items-center justify-center space-x-2">
          <span>‚ú®</span>
          <span>Register</span>
        </a>
      </div>
      
      <!-- Close Button -->
      <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
function showAuthModal() {
  document.getElementById('auth-modal').classList.remove('hidden');
  document.getElementById('auth-modal').classList.add('flex');
}

function closeAuthModal() {
  document.getElementById('auth-modal').classList.add('hidden');
  document.getElementById('auth-modal').classList.remove('flex');
}

// Close modal when clicking outside
document.getElementById('auth-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeAuthModal();
  }
});

const advice = {
  high: [
    { icon: 'üç¥', text: 'Focus on a balanced diet with controlled carbs.' },
    { icon: 'üèÉ', text: 'Aim for 30 minutes of moderate activity daily.' },
    { icon: 'üë®‚öïÔ∏è', text: 'Consult a doctor to discuss these results.' }
  ],
  moderate: [
    { icon: 'üçé', text: 'Incorporate more fruits, vegetables, and whole grains.' },
    { icon: 'üíß', text: 'Ensure you are staying well-hydrated.' },
    { icon: 'üóìÔ∏è', text: 'Consider regular monitoring and a check-up.' }
  ],
  low: [
    { icon: 'üëç', text: 'You\'re doing great! Keep up the healthy lifestyle.' },
    { icon: 'üí™', text: 'Continue with your consistent physical activity.' },
    { icon: 'ü•ó', text: 'Maintain your balanced and nutritious diet.' }
  ]
};

const healthTips = {
  high: [
    { icon: 'üö´', text: 'Avoid sugary drinks and processed foods' },
    { icon: '‚è∞', text: 'Monitor blood sugar levels regularly' },
    { icon: 'üíä', text: 'Take medications as prescribed by doctor' },
    { icon: 'ü©∫', text: 'Schedule regular medical check-ups' }
  ],
  moderate: [
    { icon: 'üèÉ‚ôÇÔ∏è', text: 'Regular exercise improves insulin sensitivity' },
    { icon: 'ü•ó', text: 'Balanced diet helps manage blood sugar' },
    { icon: 'üíß', text: 'Stay hydrated for better health' },
    { icon: 'üò¥', text: 'Quality sleep regulates hormones' }
  ],
  low: [
    { icon: 'üéØ', text: 'Maintain current healthy habits' },
    { icon: 'üçá', text: 'Continue eating nutritious foods' },
    { icon: 'üö∂', text: 'Keep up regular physical activity' },
    { icon: 'üìä', text: 'Annual health screenings recommended' }
  ]
};

function getBMICategory(bmi) {
  if (bmi < 18.5) return { category: 'Underweight', color: 'blue' };
  if (bmi < 25) return { category: 'Normal', color: 'green' };
  if (bmi < 30) return { category: 'Overweight', color: 'yellow' };
  return { category: 'Obese', color: 'red' };
}

function getGlucoseCategory(glucose) {
  if (glucose < 100) return { category: 'Normal', color: 'green' };
  if (glucose < 126) return { category: 'Prediabetes', color: 'yellow' };
  return { category: 'Diabetes', color: 'red' };
}

function updateResults(data, result) {
  const riskPercent = (result.probability * 100).toFixed(0);
  const riskLevel = riskPercent > 66 ? 'High Risk' : riskPercent >= 33 ? 'Moderate Risk' : 'Low Risk';
  const riskColor = riskPercent > 66 ? '#ef4444' : riskPercent > 33 ? '#f59e0b' : '#10b981';
  
  // Update risk title and percentage
  document.getElementById('risk-title').textContent = riskLevel;
  document.getElementById('risk-title').style.color = riskColor;
  document.getElementById('risk-percentage').textContent = riskPercent + '%';
  
  // Update circular progress
  const circumference = 2 * Math.PI * 40;
  const offset = circumference - (riskPercent / 100) * circumference;
  const circle = document.getElementById('progress-circle');
  circle.style.stroke = riskColor;
  circle.style.strokeDashoffset = offset;
  
  // Update BMI
  const bmiInfo = getBMICategory(parseFloat(data.bmi));
  document.getElementById('bmi-value').textContent = `${data.bmi} ${bmiInfo.category}`;
  document.getElementById('bmi-value').className = `font-bold text-${bmiInfo.color}-600`;
  
  // Position BMI indicator (rough calculation)
  const bmiPosition = Math.min(90, Math.max(10, (parseFloat(data.bmi) - 15) / 35 * 100));
  document.getElementById('bmi-indicator').style.left = bmiPosition + '%';
  
  // Update Glucose
  const glucoseInfo = getGlucoseCategory(parseFloat(data.glucose));
  document.getElementById('glucose-value').textContent = `${data.glucose} mg/dL ${glucoseInfo.category}`;
  document.getElementById('glucose-value').className = `font-bold text-${glucoseInfo.color}-600`;
  
  // Position glucose indicator
  const glucosePosition = Math.min(90, Math.max(10, (parseFloat(data.glucose) - 70) / 230 * 100));
  document.getElementById('glucose-indicator').style.left = glucosePosition + '%';
  
  // Update sections based on risk percentage: >66% = high, 33-66% = moderate, <33% = low
  const adviceLevel = riskPercent > 66 ? 'high' : riskPercent >= 33 ? 'moderate' : 'low';
  
  // Health Tips section uses advice object
  const healthTipsList = document.querySelector('#results-view .mt-8:last-of-type .space-y-3');
  healthTipsList.innerHTML = advice[adviceLevel].map(item => `
    <div class="flex items-start space-x-2 sm:space-x-3">
      <span class="text-lg sm:text-xl">${item.icon}</span>
      <p class="text-gray-600 text-xs sm:text-sm">${item.text}</p>
    </div>
  `).join('');
  
  // Personalized Advice section uses healthTips object
  const adviceList = document.getElementById('advice-list');
  adviceList.innerHTML = healthTips[adviceLevel].map(item => `
    <div class="flex items-start space-x-3">
      <span class="text-xl">${item.icon}</span>
      <p class="text-gray-600 text-sm">${item.text}</p>
    </div>
  `).join('');
  
  // Update prediction result
  const predictionText = result.prediction ? 'Diabetic' : 'Non-Diabetic';
  const predictionColor = result.prediction ? 'text-red-600' : 'text-green-600';
  document.getElementById('prediction-result').textContent = predictionText;
  document.getElementById('prediction-result').className = `text-2xl font-bold ${predictionColor}`;
  
  // Update key factors
  document.getElementById('key-factors-text').textContent = 
    `Your Glucose and BMI levels were primary factors in this prediction.`;
}

document.getElementById("predict-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = 'üîÑ Analyzing...';
  submitBtn.disabled = true;
  
  // Show loading screen
  document.getElementById("form-view").classList.add("hidden");
  document.getElementById("loading-view").classList.remove("hidden");
  
  // Simulate loading progress with advanced animations
  const loadingSteps = [
    { progress: 25, step: 1, text: 'Initializing neural networks...' },
    { progress: 50, step: 2, text: 'Processing health data...' },
    { progress: 75, step: 3, text: 'Computing risk probabilities...' },
    { progress: 100, step: 4, text: 'Finalizing analysis...' }
  ];
  
  for (let i = 0; i < loadingSteps.length; i++) {
    await new Promise(resolve => setTimeout(resolve, 200));
    
    // Update progress circle
    const circumference = 2 * Math.PI * 40;
    const offset = circumference - (loadingSteps[i].progress / 100) * circumference;
    document.getElementById('loading-progress-circle').style.strokeDashoffset = offset;
    document.getElementById('loading-percentage').textContent = loadingSteps[i].progress + '%';
    
    // Activate current step
    document.getElementById(`step-${loadingSteps[i].step}`).style.opacity = '1';
    document.getElementById(`step-${loadingSteps[i].step}`).style.transform = 'scale(1.05)';
    
    // Update status text
    document.getElementById('loading-status').textContent = loadingSteps[i].text;
  }
  
  try {
    const data = Object.fromEntries(new FormData(e.target).entries());
    const res = await fetch("/api/predict", {
      method: "POST",
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const result = await res.json();
    
    if (result.error) {
      if (result.error.includes('auth required')) {
        showAuthModal();
      } else {
        alert('‚ö†Ô∏è ' + result.error);
      }
      document.getElementById("loading-view").classList.add("hidden");
      document.getElementById("form-view").classList.remove("hidden");
      return; 
    }

    // Hide loading, show results
    document.getElementById("loading-view").classList.add("hidden");
    document.getElementById("results-view").classList.remove("hidden");
    
    // Update results display
    updateResults(data, result);
    
  } catch (error) {
    alert('‚ö†Ô∏è Connection error. Please try again.');
    document.getElementById("loading-view").classList.add("hidden");
    document.getElementById("form-view").classList.remove("hidden");
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// Try again button
document.getElementById('try-again-btn').addEventListener('click', () => {
  document.getElementById("predict-form").reset();
  document.getElementById("form-view").classList.remove("hidden");
  document.getElementById("results-view").classList.add("hidden");
});
</script>
{% endblock %}